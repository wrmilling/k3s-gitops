image: alpine/edge
secrets:
- 26e0dc51-9620-4f61-82e2-998932a415c7
sources:
- https://git.sr.ht/~wrmilling/k3s-gitops
tasks:
- push: |
    # Ensure we are on the main branch, exit build if not
    cd k3s-gitops
    git diff -s --exit-code origin/master || complete-build

    # Push copy of code to GitHub
    ssh-keyscan -H github.com >> ~/.ssh/known_hosts
    git remote add github git@github.com:wrmilling/k3s-gitops.git
    git push github master

    # Push copy of code to Codeberg
    ssh-keyscan -H codeberg.org >> ~/.ssh/known_hosts
    git remote add codeberg git@codeberg.org:wrmilling/k3s-gitops.git
    git push codeberg master
