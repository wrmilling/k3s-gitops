image: alpine/edge
secrets:
- 26e0dc51-9620-4f61-82e2-998932a415c7
sources:
- https://git.sr.ht/~wrmilling/k3s-gitops
tasks:
- push: |
    # Set Repo Name
    REPO=k3s-gitops
    
    # Ensure we are on the main branch, exit build if not
    cd $REPO
    git diff -s --exit-code origin/master || complete-build

    # Ignore hosts keys, since we accept them as-is
    git config --global core.sshCommand 'ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no' 

    # Push copy of code to GitHub
    git remote add github git@github.com:wrmilling/${REPO}.git
    git push github master

    # Push copy of code to Codeberg
    git remote add codeberg git@codeberg.org:wrmilling/${REPO}.git
    git push codeberg master

    # Push copy of code to GitLab
    git remote add gitlab git@gitlab.com:WRMilling/${REPO}.git
    git push gitlab master
